<!DOCTYPE html>
<html lang="tr" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Raporu | Inmapper Analytics</title>
  
  <!-- Modern Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Icons - Lucide -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  
  <!-- Flag Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icon-css/css/flag-icons.min.css">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  
  <!-- XLSX -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
  
  <link rel="stylesheet" href="pdf_style.css">
</head>

<body>
  <!-- Print Header (appears on every page when printing) -->
  <header class="print-header no-print">
    <div class="header-container">
      <div class="header-left">
        <a href="index.html" class="back-btn">
          <i data-lucide="arrow-left"></i>
          <span>Dashboard'a DÃ¶n</span>
        </a>
      </div>
      
      <div class="header-center">
        <h1>PDF Raporu Ã–nizleme</h1>
      </div>
      
      <div class="header-right">
        <button class="print-btn" onclick="window.print()">
          <i data-lucide="printer"></i>
          <span>YazdÄ±r / PDF</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Component Toggle Panel -->
  <div class="component-toggle-panel no-print" id="componentTogglePanel">
    <div class="component-toggle-header">
      <span class="toggle-icon">ğŸ“Š</span>
      <span class="toggle-title">BileÅŸenler</span>
      <button class="toggle-collapse-btn" id="componentToggleBtn" title="Paneli KÃ¼Ã§Ã¼lt">
        <i data-lucide="chevron-right"></i>
      </button>
    </div>
    <div class="component-toggle-content" id="componentToggleContent">
      <div class="toggle-info">
        <span id="activeComponentCount">0</span> / <span id="totalComponentCount">0</span> aktif
      </div>
      
      <!-- Sayfa BileÅŸenleri -->
      <div class="component-list">
        <!-- Ã–zet Bilgiler Grubu -->
        <div class="component-group">
          <div class="component-group-header">
            <span>ğŸ“‹ Ã–zet Bilgiler</span>
            <button class="group-toggle-btn" data-group="summary-group">â–²</button>
          </div>
          <div class="component-sublist expanded" data-group="summary-group">
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="summary-main" checked>
              <span>Ana Ä°statistikler</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="summary-events-breakdown" checked>
              <span>Etkinlik DaÄŸÄ±lÄ±mÄ±</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="summary-busiest-day" checked>
              <span>En YoÄŸun GÃ¼n</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="summary-platform" checked>
              <span>Platform Bilgisi</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="summary-languages" checked>
              <span>Dil DaÄŸÄ±lÄ±mÄ±</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="summary-total-visits" checked>
              <span>Toplam Ziyaret</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="summary-hourly-avg" checked>
              <span>Saatlik Ortalama</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="summary-peak-hours" checked>
              <span>Pik Saatler</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="summary-engagement" checked>
              <span>EtkileÅŸim</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="summary-top-units" checked>
              <span>PopÃ¼ler Birimler</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="summary-kiosk" checked>
              <span>Kiosk Bilgisi</span>
            </label>
          </div>
        </div>
        
        <!-- Grafikler -->
        <div class="component-group">
          <div class="component-group-header">
            <span>ğŸ“Š Grafikler</span>
            <button class="group-toggle-btn" data-group="charts-group">â–²</button>
          </div>
          <div class="component-sublist expanded" data-group="charts-group">
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="chart-daily-events" checked>
              <span>ğŸ“ˆ GÃ¼nlÃ¼k Etkinlik</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="chart-hourly-events" checked>
              <span>â° Saatlik Ziyaret</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="chart-os-distribution" checked>
              <span>ğŸ’» Ä°ÅŸletim Sistemi</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="chart-language" checked>
              <span>ğŸŒ Dil DaÄŸÄ±lÄ±mÄ±</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="chart-from-to" checked>
              <span>ğŸ—ºï¸ Rota (Hedef)</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="chart-start-end" checked>
              <span>ğŸ“ Rota (BaÅŸlangÄ±Ã§)</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="chart-top-search" checked>
              <span>ğŸ” En Ã‡ok Aranan</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="chart-searched-events" checked>
              <span>ğŸ” Arama KaynaklarÄ±</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="chart-category-donut" checked>
              <span>ğŸ¥§ Kategori DaÄŸÄ±lÄ±mÄ±</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="chart-category-trend" checked>
              <span>ğŸ“Š Kategori Trendi</span>
            </label>
          </div>
        </div>
        
        <!-- Tablolar -->
        <div class="component-group">
          <div class="component-group-header">
            <span>ğŸ“‹ Tablolar</span>
            <button class="group-toggle-btn" data-group="tables-group">â–²</button>
          </div>
          <div class="component-sublist expanded" data-group="tables-group">
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="table-top-units" checked>
              <span>ğŸ† En Aktif Birimler</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="table-services" checked>
              <span>ğŸ’¼ Hizmetler</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="table-floors" checked>
              <span>ğŸ¢ Katlar</span>
            </label>
            <label class="component-item sub-item">
              <input type="checkbox" class="component-checkbox" data-component="table-kiosks" checked>
              <span>ğŸ–¥ï¸ Kiosklar</span>
            </label>
          </div>
        </div>
      </div>
      
      <div class="toggle-actions">
        <button class="toggle-btn select-all" id="componentSelectAll">TÃ¼mÃ¼nÃ¼ SeÃ§</button>
        <button class="toggle-btn reset" id="componentReset">SÄ±fÄ±rla</button>
      </div>
    </div>
  </div>

  <!-- PDF Content -->
  <div class="pdf-container">
    
    <!-- Cover Page -->
    <section class="pdf-page cover-page" data-component="page-cover">
      <div class="cover-content">
        <div class="cover-top">
          <img src="assets/inmapper-filigran.png" alt="Inmapper" class="cover-top-logo">
        </div>
        
        <div class="cover-center">
          <img id="siteLogo" src="assets/placeholder.png" alt="Site Logo" class="site-logo">
          <div class="cover-title">
            <h1>Analiz Raporu</h1>
            <h2>KullanÄ±m Ä°statistikleri</h2>
          </div>
          <div class="cover-date" id="dateInfo">
            Tarih aralÄ±ÄŸÄ± yÃ¼kleniyor...
          </div>
        </div>
        
        <div class="cover-footer">
          <p class="copyright">Â© <span id="copyrightYear"></span> Inmapper. TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
        </div>
      </div>
      <!-- Page footer with Inmapper logo -->
      <div class="page-footer-logo">
        <img src="assets/inmapper.png" alt="Inmapper">
      </div>
    </section>

    <!-- Summary Page -->
    <section class="pdf-page" data-page="summary">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="file-text"></i>
          Ã–zet Bilgiler
        </h2>
      </div>
      
      <div class="page-content">
        <div class="summary-card">
          <ul class="summary-list" id="summary-list">
            <!-- Ana istatistikler -->
            <li id="summary-main" data-component="summary-main"></li>
            <li id="summary-events-breakdown" data-component="summary-events-breakdown"></li>
            <li id="summary-busiest-day" data-component="summary-busiest-day"></li>
            <li id="summary-platform" data-component="summary-platform"></li>
            <!-- Dil daÄŸÄ±lÄ±mÄ± -->
            <li id="summary-languages" data-component="summary-languages"></li>
            <!-- Ziyaret istatistikleri -->
            <li id="summary-total-visits" data-component="summary-total-visits"></li>
            <li id="summary-hourly-avg" data-component="summary-hourly-avg"></li>
            <li id="summary-peak-hours" data-component="summary-peak-hours"></li>
            <!-- KullanÄ±cÄ± davranÄ±ÅŸÄ± -->
            <li id="summary-engagement" data-component="summary-engagement"></li>
            <!-- En popÃ¼ler birimler -->
            <li id="summary-top-units" data-component="summary-top-units"></li>
            <!-- Kiosk bilgisi -->
            <li id="summary-kiosk" data-component="summary-kiosk"></li>
          </ul>
        </div>
      </div>
      <div class="page-footer-logo">
        <img src="assets/inmapper.png" alt="Inmapper">
      </div>
    </section>

    <!-- Usage Statistics Page -->
    <section class="pdf-page" data-page="usage-stats">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="bar-chart-3"></i>
          KullanÄ±m Ä°statistiÄŸi
        </h2>
      </div>
      
      <div class="page-content stacked-charts">
        <div class="chart-section full-height" data-component="chart-daily-events">
          <h3 class="chart-title">GÃ¼nlÃ¼k Etkinlik SayÄ±larÄ±</h3>
          <div class="chart-wrapper equal" id="daily-events"></div>
        </div>
        <div class="chart-section full-height" data-component="chart-hourly-events">
          <h3 class="chart-title">Saatlik Ziyaret DaÄŸÄ±lÄ±mÄ±</h3>
          <div class="chart-wrapper equal" id="hourly-events"></div>
        </div>
      </div>
      <div class="page-footer-logo">
        <img src="assets/inmapper.png" alt="Inmapper">
      </div>
    </section>

    <!-- Platform Statistics Page -->
    <section class="pdf-page" data-page="platform-stats">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="monitor-smartphone"></i>
          KullanÄ±m Ä°statistiÄŸi
        </h2>
      </div>
      
      <div class="page-content stacked-charts">
        <div class="chart-section full-height" data-component="chart-os-distribution">
          <h3 class="chart-title">Ä°ÅŸletim Sistemi DaÄŸÄ±lÄ±mÄ±</h3>
          <div class="chart-wrapper equal" id="operating-systems"></div>
        </div>
        <div class="chart-section full-height" data-component="chart-language">
          <h3 class="chart-title">Dil DaÄŸÄ±lÄ±mÄ±</h3>
          <div class="chart-wrapper equal" id="language-distribution"></div>
        </div>
      </div>
      <div class="page-footer-logo">
        <img src="assets/inmapper.png" alt="Inmapper">
      </div>
    </section>

    <!-- Route Statistics Page -->
    <section class="pdf-page" data-page="route-stats">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="route"></i>
          Rota Ä°statistiÄŸi
        </h2>
      </div>
      
      <div class="page-content stacked-charts">
        <div class="chart-section full-height" data-component="chart-from-to">
          <h3 class="chart-title">En Ã‡ok Gidilen Yerler ve Nerelerden GidildiÄŸi</h3>
          <div class="chart-wrapper equal" id="from-to-events"></div>
        </div>
        <div class="chart-section full-height" data-component="chart-start-end">
          <h3 class="chart-title">BaÅŸlangÄ±Ã§ NoktalarÄ±na GÃ¶re Hedef DaÄŸÄ±lÄ±mÄ±</h3>
          <div class="chart-wrapper equal" id="start-to-end-events"></div>
        </div>
      </div>
      <div class="page-footer-logo">
        <img src="assets/inmapper.png" alt="Inmapper">
      </div>
    </section>

    <!-- Search Statistics Page -->
    <section class="pdf-page" data-page="search-stats">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="search"></i>
          Arama Ä°statistiÄŸi
        </h2>
      </div>
      
      <div class="page-content stacked-charts">
        <div class="chart-section full-height" data-component="chart-top-search">
          <h3 class="chart-title">En Ã‡ok YapÄ±lan Aramalar</h3>
          <div class="chart-wrapper equal" id="top-searchs"></div>
        </div>
        <div class="chart-section full-height" data-component="chart-searched-events">
          <h3 class="chart-title">SeÃ§ilen Yerler ve Arama KaynaklarÄ±</h3>
          <div class="chart-wrapper equal" id="searched-events"></div>
        </div>
      </div>
      <div class="page-footer-logo">
        <img src="assets/inmapper.png" alt="Inmapper">
      </div>
    </section>

    <!-- Category Statistics Page -->
    <section class="pdf-page" data-page="category-stats">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="pie-chart"></i>
          Kategorik Ä°statistikler
        </h2>
      </div>
      
      <div class="page-content stacked-charts">
        <div class="chart-section full-height" data-component="chart-category-donut">
          <h3 class="chart-title">Kategori DaÄŸÄ±lÄ±mÄ±</h3>
          <div class="chart-wrapper equal" id="donut-container"></div>
        </div>
        <div class="chart-section full-height" data-component="chart-category-trend">
          <h3 class="chart-title">Zaman BazlÄ± Kategori Trendi</h3>
          <div class="chart-wrapper equal" id="area-chart-container"></div>
        </div>
      </div>
      <div class="page-footer-logo">
        <img src="assets/inmapper.png" alt="Inmapper">
      </div>
    </section>

    <!-- Top Units Table Page -->
    <section class="pdf-page" data-component="table-top-units">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="trophy"></i>
          En Ã‡ok Etkinlik GÃ¶steren Birimler
        </h2>
      </div>
      
      <div class="page-content">
        <div class="table-section" id="top-units-table-container"></div>
      </div>
      <div class="page-footer-logo">
        <img src="assets/inmapper.png" alt="Inmapper">
      </div>
    </section>

    <!-- Services Table Page -->
    <section class="pdf-page" data-component="table-services">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="briefcase"></i>
          Hizmetlere GÃ¶re DaÄŸÄ±lÄ±m
        </h2>
      </div>
      
      <div class="page-content">
        <div class="table-section" id="services-container"></div>
      </div>
      <div class="page-footer-logo">
        <img src="assets/inmapper.png" alt="Inmapper">
      </div>
    </section>

    <!-- Floors Table Page -->
    <section class="pdf-page" data-component="table-floors">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="building"></i>
          Katlara GÃ¶re DaÄŸÄ±lÄ±m
        </h2>
      </div>
      
      <div class="page-content">
        <div class="table-section" id="floors-container"></div>
      </div>
      <div class="page-footer-logo">
        <img src="assets/inmapper.png" alt="Inmapper">
      </div>
    </section>

    <!-- Kiosks Table Page -->
    <section class="pdf-page" data-component="table-kiosks">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="monitor"></i>
          Kiosklara GÃ¶re DaÄŸÄ±lÄ±m
        </h2>
      </div>
      
      <div class="page-content">
        <div class="table-section" id="kiosks-container"></div>
      </div>
      <div class="page-footer-logo">
        <img src="assets/inmapper.png" alt="Inmapper">
      </div>
    </section>

  </div>

  <script>
    // =====================================================
    // Component Toggle System
    // =====================================================
    
    const componentConfig = {
      // Ã–zet Bilgiler Maddeleri
      'summary-main': { name: 'Ana Ä°statistikler', default: true, group: 'summary' },
      'summary-events-breakdown': { name: 'Etkinlik DaÄŸÄ±lÄ±mÄ±', default: true, group: 'summary' },
      'summary-busiest-day': { name: 'En YoÄŸun GÃ¼n', default: true, group: 'summary' },
      'summary-platform': { name: 'Platform Bilgisi', default: true, group: 'summary' },
      'summary-languages': { name: 'Dil DaÄŸÄ±lÄ±mÄ±', default: true, group: 'summary' },
      'summary-total-visits': { name: 'Toplam Ziyaret', default: true, group: 'summary' },
      'summary-hourly-avg': { name: 'Saatlik Ortalama', default: true, group: 'summary' },
      'summary-peak-hours': { name: 'Pik Saatler', default: true, group: 'summary' },
      'summary-engagement': { name: 'EtkileÅŸim', default: true, group: 'summary' },
      'summary-top-units': { name: 'PopÃ¼ler Birimler', default: true, group: 'summary' },
      'summary-kiosk': { name: 'Kiosk Bilgisi', default: true, group: 'summary' },
      
      // Grafikler
      'chart-daily-events': { name: 'GÃ¼nlÃ¼k Etkinlik', default: true, page: 'usage-stats' },
      'chart-hourly-events': { name: 'Saatlik Ziyaret', default: true, page: 'usage-stats' },
      'chart-os-distribution': { name: 'Ä°ÅŸletim Sistemi', default: true, page: 'platform-stats' },
      'chart-language': { name: 'Dil DaÄŸÄ±lÄ±mÄ±', default: true, page: 'platform-stats' },
      'chart-from-to': { name: 'Rota (Hedef)', default: true, page: 'route-stats' },
      'chart-start-end': { name: 'Rota (BaÅŸlangÄ±Ã§)', default: true, page: 'route-stats' },
      'chart-top-search': { name: 'En Ã‡ok Aranan', default: true, page: 'search-stats' },
      'chart-searched-events': { name: 'Arama KaynaklarÄ±', default: true, page: 'search-stats' },
      'chart-category-donut': { name: 'Kategori DaÄŸÄ±lÄ±mÄ±', default: true, page: 'category-stats' },
      'chart-category-trend': { name: 'Kategori Trendi', default: true, page: 'category-stats' },
      
      // Tablolar
      'table-top-units': { name: 'En Aktif Birimler', default: true },
      'table-services': { name: 'Hizmetler', default: true },
      'table-floors': { name: 'Katlar', default: true },
      'table-kiosks': { name: 'Kiosklar', default: true }
    };

    // Load component visibility from localStorage
    function loadComponentVisibility() {
      const saved = localStorage.getItem('pdfComponentVisibility');
      if (saved) {
        try {
          return JSON.parse(saved);
        } catch (e) {
          return {};
        }
      }
      return {};
    }

    // Save component visibility to localStorage
    function saveComponentVisibility(visibility) {
      localStorage.setItem('pdfComponentVisibility', JSON.stringify(visibility));
    }

    // Get current component visibility state
    function getComponentVisibility() {
      const saved = loadComponentVisibility();
      const visibility = {};
      
      Object.keys(componentConfig).forEach(key => {
        visibility[key] = saved.hasOwnProperty(key) ? saved[key] : componentConfig[key].default;
      });
      
      return visibility;
    }

    // Apply visibility to DOM
    function applyComponentVisibility(visibility) {
      Object.entries(visibility).forEach(([componentId, isVisible]) => {
        const elements = document.querySelectorAll(`[data-component="${componentId}"]`);
        elements.forEach(el => {
          if (isVisible) {
            el.classList.remove('component-hidden');
          } else {
            el.classList.add('component-hidden');
          }
        });
      });
      
      // Update dynamic layouts
      updateDynamicLayouts();
      
      // Update counter
      updateComponentCount();
    }

    // Update dynamic layouts based on visible components
    function updateDynamicLayouts() {
      const visibility = getComponentVisibility();
      
      // Check pages with paired charts - hide page only if both hidden
      // Charts do NOT expand - they stay the same size
      const pairedPages = [
        { page: 'usage-stats', components: ['chart-daily-events', 'chart-hourly-events'] },
        { page: 'platform-stats', components: ['chart-os-distribution', 'chart-language'] },
        { page: 'route-stats', components: ['chart-from-to', 'chart-start-end'] },
        { page: 'search-stats', components: ['chart-top-search', 'chart-searched-events'] },
        { page: 'category-stats', components: ['chart-category-donut', 'chart-category-trend'] }
      ];
      
      pairedPages.forEach(({ page, components }) => {
        const pageEl = document.querySelector(`[data-page="${page}"]`);
        if (!pageEl) return;
        
        const [comp1, comp2] = components;
        const vis1 = visibility[comp1];
        const vis2 = visibility[comp2];
        
        // Hide page if both components are hidden
        if (!vis1 && !vis2) {
          pageEl.classList.add('component-hidden');
        } else {
          pageEl.classList.remove('component-hidden');
        }
      });
      
      // Check if summary page should be hidden (all summary items hidden)
      const summaryComponents = Object.keys(componentConfig).filter(k => k.startsWith('summary-'));
      const anySummaryVisible = summaryComponents.some(k => visibility[k]);
      const summaryPage = document.querySelector('[data-page="summary"]');
      if (summaryPage) {
        if (anySummaryVisible) {
          summaryPage.classList.remove('component-hidden');
        } else {
          summaryPage.classList.add('component-hidden');
        }
      }
    }

    // Update component counter
    function updateComponentCount() {
      const visibility = getComponentVisibility();
      const active = Object.values(visibility).filter(v => v).length;
      const total = Object.keys(componentConfig).length;
      
      const activeEl = document.getElementById('activeComponentCount');
      const totalEl = document.getElementById('totalComponentCount');
      
      if (activeEl) activeEl.textContent = active;
      if (totalEl) totalEl.textContent = total;
    }

    // Initialize component toggle panel
    function initComponentTogglePanel() {
      const panel = document.getElementById('componentTogglePanel');
      const toggleBtn = document.getElementById('componentToggleBtn');
      
      if (!panel) return;
      
      // Panel collapse/expand
      toggleBtn?.addEventListener('click', (e) => {
        e.stopPropagation();
        panel.classList.toggle('collapsed');
        const icon = toggleBtn.querySelector('svg');
        if (icon) {
          icon.style.transform = panel.classList.contains('collapsed') ? 'rotate(180deg)' : '';
        }
      });
      
      // Group toggle buttons (expand/collapse sublists)
      document.querySelectorAll('.group-toggle-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const groupName = btn.dataset.group;
          const sublist = document.querySelector(`.component-sublist[data-group="${groupName}"]`);
          if (sublist) {
            const isExpanded = sublist.classList.contains('expanded');
            sublist.classList.toggle('expanded');
            btn.textContent = isExpanded ? 'â–¼' : 'â–²';
          }
        });
      });
      
      // Load and apply saved visibility
      const visibility = getComponentVisibility();
      
      // Set checkbox states
      document.querySelectorAll('.component-checkbox').forEach(checkbox => {
        const componentId = checkbox.dataset.component;
        if (componentId && visibility.hasOwnProperty(componentId)) {
          checkbox.checked = visibility[componentId];
        }
      });
      
      // Apply visibility to DOM
      applyComponentVisibility(visibility);
      
      // Checkbox change handlers
      document.querySelectorAll('.component-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', (e) => {
          const componentId = e.target.dataset.component;
          const visibility = getComponentVisibility();
          
          visibility[componentId] = e.target.checked;
          
          saveComponentVisibility(visibility);
          applyComponentVisibility(visibility);
        });
      });
      
      // Select all button
      document.getElementById('componentSelectAll')?.addEventListener('click', () => {
        const visibility = getComponentVisibility();
        Object.keys(visibility).forEach(key => {
          visibility[key] = true;
        });
        
        document.querySelectorAll('.component-checkbox').forEach(cb => {
          cb.checked = true;
        });
        
        saveComponentVisibility(visibility);
        applyComponentVisibility(visibility);
      });
      
      // Reset button
      document.getElementById('componentReset')?.addEventListener('click', () => {
        localStorage.removeItem('pdfComponentVisibility');
        
        document.querySelectorAll('.component-checkbox').forEach(cb => {
          const componentId = cb.dataset.component;
          cb.checked = componentConfig[componentId]?.default ?? true;
        });
        
        const visibility = getComponentVisibility();
        applyComponentVisibility(visibility);
      });
    }

    // Initialize page
    window.addEventListener("DOMContentLoaded", () => {
      // Initialize Lucide icons
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
      
      // Set dynamic copyright year
      const copyrightYearEl = document.getElementById('copyrightYear');
      if (copyrightYearEl) {
        copyrightYearEl.textContent = new Date().getFullYear();
      }
      
      // Initialize component toggle panel
      initComponentTogglePanel();
      
      const dateInfo = document.getElementById("dateInfo");
      const selectedRange = localStorage.getItem("selectedRange");
      const startDateStr = localStorage.getItem("startDate");
      const endDateStr = localStorage.getItem("endDate");

      const formatDate = (date) => {
        return date.toLocaleDateString("tr-TR", {
          day: "2-digit",
          month: "long",
          year: "numeric"
        });
      };

      const getDayName = (date) => {
        return date.toLocaleDateString("tr-TR", { weekday: "long" });
      };

      const now = new Date();

      if (selectedRange) {
        const range = parseInt(selectedRange);
        let text = "";

        if (range === 1) {
          text = `${formatDate(now)} - ${getDayName(now)}`;
        } else if (range === 7) {
          const past = new Date(now);
          past.setDate(now.getDate() - 6);
          text = `${formatDate(past)} â€” ${formatDate(now)}`;
        } else if (range === 30) {
          const monthName = now.toLocaleDateString("tr-TR", { month: "long", year: "numeric" });
          text = monthName.charAt(0).toUpperCase() + monthName.slice(1);
        } else if (range === 365) {
          text = `${now.getFullYear()} YÄ±lÄ±`;
        }

        dateInfo.textContent = text;
      } else if (startDateStr && endDateStr) {
        const start = new Date(startDateStr);
        const end = new Date(endDateStr);
        dateInfo.textContent = `${formatDate(start)} â€” ${formatDate(end)}`;
      } else {
        dateInfo.textContent = "Tarih aralÄ±ÄŸÄ± belirlenmedi";
      }

      // Site logo
      const logoImg = document.getElementById("siteLogo");
      const selectedSiteId = localStorage.getItem("selectedSiteId");
      if (selectedSiteId) {
        logoImg.src = `assets/${selectedSiteId}.png`;
        logoImg.onerror = () => {
          logoImg.src = "assets/inmapper.png";
        };
      }
    });

    // Page navigation
    function goToPage(targetPage) {
      window.location.href = targetPage;
    }
    
    // Flag to indicate this is PDF page
    window.isPdfPage = true;
  </script>
  
  <script type="module" src="./scripts/script.js"></script>
</body>

</html>
