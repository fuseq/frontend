<!DOCTYPE html>
<html lang="tr" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Raporu | Inmapper Analytics</title>
  
  <!-- Modern Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Icons - Lucide -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  
  <!-- Flag Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icon-css/css/flag-icons.min.css">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  
  <!-- XLSX -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
  
  <link rel="stylesheet" href="pdf_style.css">
</head>

<body>
  <!-- Print Header (appears on every page when printing) -->
  <header class="print-header no-print">
    <div class="header-container">
      <div class="header-left">
        <a href="index.html" class="back-btn">
          <i data-lucide="arrow-left"></i>
          <span>Dashboard'a Dön</span>
        </a>
      </div>
      
      <div class="header-center">
        <h1>PDF Raporu Önizleme</h1>
      </div>
      
      <div class="header-right">
        <button class="print-btn" onclick="window.print()">
          <i data-lucide="printer"></i>
          <span>Yazdır / PDF</span>
        </button>
      </div>
    </div>
  </header>

  <!-- PDF Content -->
  <div class="pdf-container">
    
    <!-- Cover Page -->
    <section class="pdf-page cover-page">
      <div class="cover-content">
        <div class="cover-header">
          <img src="assets/inmapper.png" alt="Inmapper" class="inmapper-logo">
        </div>
        
        <div class="cover-center">
          <img id="siteLogo" src="assets/placeholder.png" alt="Site Logo" class="site-logo">
          <div class="cover-title">
            <h1>Analiz Raporu</h1>
            <h2>Kullanım İstatistikleri</h2>
          </div>
          <div class="cover-date" id="dateInfo">
            Tarih aralığı yükleniyor...
          </div>
        </div>
        
        <div class="cover-footer">
          <img src="assets/inmapper-filigran.png" alt="" class="watermark">
          <p class="copyright">© 2024 Inmapper. Tüm hakları saklıdır.</p>
        </div>
      </div>
    </section>

    <!-- Summary Page -->
    <section class="pdf-page">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="file-text"></i>
          Özet Bilgiler
        </h2>
      </div>
      
      <div class="page-content">
        <div class="summary-card">
          <ul class="summary-list" id="summary-list">
            <!-- Ana istatistikler -->
            <li id="summary-main"></li>
            <li id="summary-events-breakdown"></li>
            <li id="summary-busiest-day"></li>
            <li id="summary-platform"></li>
            <!-- Dil dağılımı -->
            <li id="summary-languages"></li>
            <!-- Ziyaret istatistikleri -->
            <li id="summary-total-visits"></li>
            <li id="summary-hourly-avg"></li>
            <li id="summary-peak-hours"></li>
            <!-- Kullanıcı davranışı -->
            <li id="summary-engagement"></li>
            <!-- En popüler birimler -->
            <li id="summary-top-units"></li>
            <!-- Kiosk bilgisi -->
            <li id="summary-kiosk"></li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Usage Statistics Page -->
    <section class="pdf-page">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="bar-chart-3"></i>
          Kullanım İstatistiği
        </h2>
      </div>
      
      <div class="page-content stacked-charts">
        <div class="chart-section full-height">
          <h3 class="chart-title">Günlük Etkinlik Sayıları</h3>
          <div class="chart-wrapper equal" id="daily-events"></div>
        </div>
        <div class="chart-section full-height">
          <h3 class="chart-title">Saatlik Ziyaret Dağılımı</h3>
          <div class="chart-wrapper equal" id="hourly-events"></div>
        </div>
      </div>
    </section>

    <!-- Platform Statistics Page -->
    <section class="pdf-page">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="monitor-smartphone"></i>
          Kullanım İstatistiği
        </h2>
      </div>
      
      <div class="page-content stacked-charts">
        <div class="chart-section full-height">
          <h3 class="chart-title">İşletim Sistemi Dağılımı</h3>
          <div class="chart-wrapper equal" id="operating-systems"></div>
        </div>
        <div class="chart-section full-height">
          <h3 class="chart-title">Dil Dağılımı</h3>
          <div class="chart-wrapper equal" id="language-distribution"></div>
        </div>
      </div>
    </section>

    <!-- Route Statistics Page -->
    <section class="pdf-page">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="route"></i>
          Rota İstatistiği
        </h2>
      </div>
      
      <div class="page-content stacked-charts">
        <div class="chart-section full-height">
          <h3 class="chart-title">En Çok Gidilen Yerler ve Nerelerden Gidildiği</h3>
          <div class="chart-wrapper equal" id="from-to-events"></div>
        </div>
        <div class="chart-section full-height">
          <h3 class="chart-title">Başlangıç Noktalarına Göre Hedef Dağılımı</h3>
          <div class="chart-wrapper equal" id="start-to-end-events"></div>
        </div>
      </div>
    </section>

    <!-- Search Statistics Page -->
    <section class="pdf-page">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="search"></i>
          Arama İstatistiği
        </h2>
      </div>
      
      <div class="page-content stacked-charts">
        <div class="chart-section full-height">
          <h3 class="chart-title">En Çok Yapılan Aramalar</h3>
          <div class="chart-wrapper equal" id="top-searchs"></div>
        </div>
        <div class="chart-section full-height">
          <h3 class="chart-title">Seçilen Yerler ve Arama Kaynakları</h3>
          <div class="chart-wrapper equal" id="searched-events"></div>
        </div>
      </div>
    </section>

    <!-- Category Statistics Page -->
    <section class="pdf-page">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="pie-chart"></i>
          Kategorik İstatistikler
        </h2>
      </div>
      
      <div class="page-content stacked-charts">
        <div class="chart-section full-height">
          <h3 class="chart-title">Kategori Dağılımı</h3>
          <div class="chart-wrapper equal" id="donut-container"></div>
        </div>
        <div class="chart-section full-height">
          <h3 class="chart-title">Zaman Bazlı Kategori Trendi</h3>
          <div class="chart-wrapper equal" id="area-chart-container"></div>
        </div>
      </div>
    </section>

    <!-- Top Units Table Page -->
    <section class="pdf-page">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="trophy"></i>
          En Çok Etkinlik Gösteren Birimler
        </h2>
      </div>
      
      <div class="page-content">
        <div class="table-section" id="top-units-table-container"></div>
      </div>
    </section>

    <!-- Services Table Page -->
    <section class="pdf-page">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="briefcase"></i>
          Hizmetlere Göre Dağılım
        </h2>
      </div>
      
      <div class="page-content">
        <div class="table-section" id="services-container"></div>
      </div>
    </section>

    <!-- Floors Table Page -->
    <section class="pdf-page">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="building"></i>
          Katlara Göre Dağılım
        </h2>
      </div>
      
      <div class="page-content">
        <div class="table-section" id="floors-container"></div>
      </div>
    </section>

    <!-- Kiosks Table Page -->
    <section class="pdf-page">
      <div class="page-header">
        <h2 class="page-title">
          <i data-lucide="monitor"></i>
          Kiosklara Göre Dağılım
        </h2>
      </div>
      
      <div class="page-content">
        <div class="table-section" id="kiosks-container"></div>
      </div>
    </section>

  </div>

  <script>
    // Initialize page
    window.addEventListener("DOMContentLoaded", () => {
      // Initialize Lucide icons
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
      
      const dateInfo = document.getElementById("dateInfo");
      const selectedRange = localStorage.getItem("selectedRange");
      const startDateStr = localStorage.getItem("startDate");
      const endDateStr = localStorage.getItem("endDate");

      const formatDate = (date) => {
        return date.toLocaleDateString("tr-TR", {
          day: "2-digit",
          month: "long",
          year: "numeric"
        });
      };

      const getDayName = (date) => {
        return date.toLocaleDateString("tr-TR", { weekday: "long" });
      };

      const now = new Date();

      if (selectedRange) {
        const range = parseInt(selectedRange);
        let text = "";

        if (range === 1) {
          text = `${formatDate(now)} - ${getDayName(now)}`;
        } else if (range === 7) {
          const past = new Date(now);
          past.setDate(now.getDate() - 6);
          text = `${formatDate(past)} — ${formatDate(now)}`;
        } else if (range === 30) {
          const monthName = now.toLocaleDateString("tr-TR", { month: "long", year: "numeric" });
          text = monthName.charAt(0).toUpperCase() + monthName.slice(1);
        } else if (range === 365) {
          text = `${now.getFullYear()} Yılı`;
        }

        dateInfo.textContent = text;
      } else if (startDateStr && endDateStr) {
        const start = new Date(startDateStr);
        const end = new Date(endDateStr);
        dateInfo.textContent = `${formatDate(start)} — ${formatDate(end)}`;
      } else {
        dateInfo.textContent = "Tarih aralığı belirlenmedi";
      }

      // Site logo
      const logoImg = document.getElementById("siteLogo");
      const selectedSiteId = localStorage.getItem("selectedSiteId");
      if (selectedSiteId) {
        logoImg.src = `assets/${selectedSiteId}.png`;
        logoImg.onerror = () => {
          logoImg.src = "assets/inmapper.png";
        };
      }
    });

    // Page navigation
    function goToPage(targetPage) {
      window.location.href = targetPage;
    }
    
    // Flag to indicate this is PDF page
    window.isPdfPage = true;
  </script>
  
  <script type="module" src="./scripts/script.js"></script>
</body>

</html>
