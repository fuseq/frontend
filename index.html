<!DOCTYPE html>
<html lang="tr" data-theme="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics Dashboard | Inmapper</title>
  
  <!-- Inmapper Auth SDK -->
  <script src="https://inmapper-otp.netlify.app/sdk/inmapper-auth.js"></script>
  <script>
    const auth = new InmapperAuth();
    auth.protect();
  </script>
  
  <!-- Modern Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Icons - Lucide -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  
  <!-- Flag Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icon-css/css/flag-icons.min.css">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>
  
  <!-- XLSX -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
  
  <!-- Holidays -->
  <script src="https://unpkg.com/date-holidays@2.3.1/lib/index.umd.js"></script>
  
  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <div class="logo-icon">
          <img src="assets/inmapper-filigran.png" alt="Inmapper" />
        </div>
        <span class="logo-text"><span class="logo-in">in</span><span class="logo-mapper">Mapper</span></span>
      </div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section">
        <span class="nav-section-title">Ana MenÃ¼</span>
        <div class="nav-item-group">
          <a href="#" class="nav-item active" data-scroll="top">
            <i data-lucide="layout-dashboard"></i>
            <span>Dashboard</span>
          </a>
          <div class="nav-subitems">
            <a href="#" class="nav-subitem" data-scroll="route-section">
              <i data-lucide="route"></i>
              <span>Rota Analizi</span>
            </a>
            <a href="#" class="nav-subitem" data-scroll="search-section">
              <i data-lucide="search"></i>
              <span>Arama Verileri</span>
            </a>
            <a href="#" class="nav-subitem" data-scroll="category-section">
              <i data-lucide="pie-chart"></i>
              <span>Kategoriler</span>
            </a>
            <a href="#" class="nav-subitem" data-scroll="tables-section">
              <i data-lucide="table-2"></i>
              <span>Tablolar</span>
            </a>
          </div>
        </div>
      </div>

      <div class="nav-section">
        <span class="nav-section-title">Raporlar</span>
        <a href="pdf_layout.html" class="nav-item">
          <i data-lucide="file-text"></i>
          <span>PDF Raporu</span>
        </a>
        <button class="nav-item" id="annualReportBtn" onclick="openAnnualReportModal()">
          <i data-lucide="calendar-range"></i>
          <span>YÄ±llÄ±k Ã–zet</span>
        </button>
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="site-selector">
        <button class="site-selector-btn" id="siteSelectorBtn">
          <i data-lucide="building-2"></i>
          <span id="selectedSiteName">Site SeÃ§</span>
          <i data-lucide="chevron-down"></i>
        </button>
        <div class="site-dropdown" id="siteDropdown">
          <div class="site-dropdown-header">
            <i data-lucide="search"></i>
            <input type="text" placeholder="Site ara..." id="siteSearch">
          </div>
          <div class="site-dropdown-list" id="siteDropdownList">
            <!-- Sites will be populated dynamically -->
          </div>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <button class="mobile-menu-btn" id="mobileMenuBtn">
          <i data-lucide="menu"></i>
        </button>
        <div class="breadcrumb">
          <span class="breadcrumb-item">Dashboard</span>
          <i data-lucide="chevron-right"></i>
          <span class="breadcrumb-item active">Genel BakÄ±ÅŸ</span>
        </div>
      </div>

      <div class="header-center">
        <div class="date-range-picker">
          <div class="date-inputs">
            <div class="date-input-group">
              <i data-lucide="calendar"></i>
              <input type="date" id="startDate" class="date-input">
            </div>
            <span class="date-separator">â€”</span>
            <div class="date-input-group">
              <i data-lucide="calendar"></i>
              <input type="date" id="endDate" class="date-input">
            </div>
          </div>
          <div class="quick-range-btns">
            <button type="button" class="quick-range-btn" id="btn-1g" data-days="1">BugÃ¼n</button>
            <button type="button" class="quick-range-btn" id="btn-1h" data-days="7">7 GÃ¼n</button>
            <button type="button" class="quick-range-btn" id="btn-1a" data-days="30">30 GÃ¼n</button>
            <button type="button" class="quick-range-btn" id="btn-1y" data-days="365">1 YÄ±l</button>
          </div>
          <button type="button" class="fetch-btn" id="fetchDataBtn">
            <i data-lucide="refresh-cw"></i>
            <span>Verileri Getir</span>
          </button>
        </div>
      </div>

      <div class="header-right">
        <button class="header-icon-btn" id="themeToggle" title="Tema DeÄŸiÅŸtir">
          <svg id="themeIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
        </button>
      </div>
    </header>

    <!-- Dashboard Content -->
    <div class="dashboard-content">
      <!-- Loading Overlay -->
      <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
          <div class="spinner"></div>
          <span>Veriler yÃ¼kleniyor...</span>
        </div>
      </div>

      <!-- Stats Cards -->
      <section class="stats-grid">
        <div class="stat-card" id="total-visits">
          <div class="stat-card-icon blue">
            <i data-lucide="users"></i>
          </div>
          <div class="stat-card-content">
            <span class="stat-label">Toplam Ziyaret</span>
            <span class="stat-value">-</span>
          </div>
        </div>

        <div class="stat-card" id="bounce-rate">
          <div class="stat-card-icon purple">
            <i data-lucide="activity"></i>
          </div>
          <div class="stat-card-content">
            <span class="stat-label">ZiyaretÃ§i Ä°lgisi</span>
            <span class="stat-value">-</span>
          </div>
        </div>

        <div class="stat-card" id="most-visited-device">
          <div class="stat-card-icon green">
            <i data-lucide="smartphone"></i>
          </div>
          <div class="stat-card-content">
            <span class="stat-label">En Ã‡ok KullanÄ±lan Cihaz</span>
            <span class="stat-value">-</span>
          </div>
        </div>

        <div class="stat-card" id="avg-time">
          <div class="stat-card-icon orange">
            <i data-lucide="clock"></i>
          </div>
          <div class="stat-card-content">
            <span class="stat-label">Ort. Kalma SÃ¼resi</span>
            <span class="stat-value">-</span>
          </div>
        </div>
      </section>

      <!-- Usage Statistics Section -->
      <section class="dashboard-section">
        <div class="section-header">
          <h2 class="section-title">
            <i data-lucide="bar-chart-3"></i>
            KullanÄ±m Ä°statistikleri
          </h2>
        </div>

        <div class="charts-grid equal">
          <div class="chart-card equal-height">
            <div class="chart-card-header">
              <h3>GÃ¼nlÃ¼k Etkinlik SayÄ±larÄ±</h3>
              <div class="chart-legend" id="daily-legend"></div>
            </div>
            <div class="chart-container" id="daily-events"></div>
          </div>

          <div class="chart-card equal-height">
            <div class="chart-card-header">
              <h3>Saatlik Ziyaret DaÄŸÄ±lÄ±mÄ±</h3>
            </div>
            <div class="chart-container" id="hourly-events"></div>
          </div>
        </div>

        <div class="charts-grid two-cols">
          <div class="chart-card">
            <div class="chart-card-header">
              <h3>Ä°ÅŸletim Sistemi DaÄŸÄ±lÄ±mÄ±</h3>
            </div>
            <div class="chart-container pie" id="operating-systems"></div>
          </div>

          <div class="chart-card">
            <div class="chart-card-header">
              <h3>Dil DaÄŸÄ±lÄ±mÄ±</h3>
            </div>
            <div class="chart-container pie" id="language-distribution"></div>
          </div>
        </div>
      </section>

      <!-- Route Statistics Section -->
      <section class="dashboard-section" id="route-section">
        <div class="section-header">
          <h2 class="section-title">
            <i data-lucide="route"></i>
            Rota Ä°statistikleri
          </h2>
        </div>

        <div class="charts-grid two-cols">
          <div class="chart-card">
            <div class="chart-card-header">
              <h3>En Ã‡ok Gidilen Yerler</h3>
              <span class="chart-subtitle">Hedef noktalarÄ±na gÃ¶re daÄŸÄ±lÄ±m</span>
            </div>
            <div class="chart-container" id="from-to-events"></div>
          </div>

          <div class="chart-card">
            <div class="chart-card-header">
              <h3>BaÅŸlangÄ±Ã§ NoktalarÄ±</h3>
              <span class="chart-subtitle">Nereden nereye analizi</span>
            </div>
            <div class="chart-container" id="start-to-end-events"></div>
          </div>
        </div>
      </section>

      <!-- Search Statistics Section -->
      <section class="dashboard-section" id="search-section">
        <div class="section-header">
          <h2 class="section-title">
            <i data-lucide="search"></i>
            Arama Ä°statistikleri
          </h2>
        </div>

        <div class="charts-grid two-cols">
          <div class="chart-card">
            <div class="chart-card-header">
              <h3>En Ã‡ok YapÄ±lan Aramalar</h3>
            </div>
            <div class="chart-container" id="top-searchs"></div>
          </div>

          <div class="chart-card">
            <div class="chart-card-header">
              <h3>SeÃ§ilen Yerler ve Arama KaynaklarÄ±</h3>
            </div>
            <div class="chart-container" id="searched-events"></div>
          </div>
        </div>
      </section>

      <!-- Category Statistics Section -->
      <section class="dashboard-section" id="category-section">
        <div class="section-header">
          <h2 class="section-title">
            <i data-lucide="pie-chart"></i>
            Kategorik Ä°statistikler
          </h2>
        </div>

        <div class="charts-grid two-cols">
          <div class="chart-card">
            <div class="chart-card-header">
              <h3>Ana Kategorilere GÃ¶re DaÄŸÄ±lÄ±m</h3>
            </div>
            <div class="chart-container pie" id="donut-container"></div>
          </div>

          <div class="chart-card">
            <div class="chart-card-header">
              <h3>Kategorilere GÃ¶re Zaman DaÄŸÄ±lÄ±mÄ±</h3>
            </div>
            <div class="chart-container" id="area-chart-container"></div>
          </div>
        </div>

        <div class="tables-grid" id="tables-section">
          <div class="table-card">
            <div class="table-card-header">
              <h3>
                <i data-lucide="trophy"></i>
                En Ã‡ok Etkinlik GÃ¶steren Birimler
              </h3>
            </div>
            <div class="table-container" id="top-units-table-container"></div>
          </div>

          <div class="table-card">
            <div class="table-card-header">
              <h3>
                <i data-lucide="briefcase"></i>
                Hizmetlere GÃ¶re DaÄŸÄ±lÄ±m
              </h3>
            </div>
            <div class="table-container" id="services-container"></div>
          </div>
        </div>

        <div class="tables-grid">
          <div class="table-card">
            <div class="table-card-header">
              <h3>
                <i data-lucide="layers"></i>
                Katlara GÃ¶re DaÄŸÄ±lÄ±m
              </h3>
            </div>
            <div class="table-container" id="floors-container"></div>
          </div>

          <div class="table-card">
            <div class="table-card-header">
              <h3>
                <i data-lucide="monitor"></i>
                Kiosklara GÃ¶re DaÄŸÄ±lÄ±m
              </h3>
            </div>
            <div class="table-container" id="kiosks-container"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <script>
    // Theme toggle and navigation helpers
    function goToPage(targetPage) {
      const startDate = document.getElementById("startDate")?.value;
      const endDate = document.getElementById("endDate")?.value;
      let url = targetPage;
      if (startDate && endDate) {
        url += `?startDate=${startDate}&endDate=${endDate}`;
      }
      window.location.href = url;
    }

    // Initialize theme and icons
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize Lucide icons
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
      
      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
      updateThemeIcon(savedTheme);
    });

    function updateThemeIcon(theme) {
      const icon = document.getElementById('themeIcon');
      if (icon) {
        if (theme === 'dark') {
          // Sun icon for dark mode (click to switch to light)
          icon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
        } else {
          // Moon icon for light mode (click to switch to dark)
          icon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
        }
      }
    }

    document.getElementById('themeToggle')?.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeIcon(newTheme);
    });

    // Navigation scroll functionality
    document.querySelectorAll('[data-scroll]').forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = item.getAttribute('data-scroll');
        
        if (targetId === 'top') {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        } else {
          const targetElement = document.getElementById(targetId);
          if (targetElement) {
            const headerOffset = 100; // Header iÃ§in boÅŸluk
            const elementPosition = targetElement.getBoundingClientRect().top;
            const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
            
            window.scrollTo({
              top: offsetPosition,
              behavior: 'smooth'
            });
          }
        }
        
        // Close mobile menu if open
        document.getElementById('sidebar')?.classList.remove('mobile-open');
      });
    });

    // Mobile menu
    document.getElementById('mobileMenuBtn')?.addEventListener('click', () => {
      document.getElementById('sidebar').classList.toggle('mobile-open');
    });

    // Site dropdown
    document.getElementById('siteSelectorBtn')?.addEventListener('click', (e) => {
      e.stopPropagation();
      document.getElementById('siteDropdown').classList.toggle('open');
    });

    document.addEventListener('click', () => {
      document.getElementById('siteDropdown')?.classList.remove('open');
    });
  </script>

  <script type="module" src="./scripts/script.js"></script>

  <!-- Annual Report Site Selection Modal -->
  <div class="annual-modal-overlay" id="annualReportModal">
    <div class="annual-modal">
      <div class="annual-modal-header">
        <h2><i data-lucide="calendar-range"></i> YÄ±llÄ±k Ã–zet Raporu</h2>
        <button class="annual-modal-close" onclick="closeAnnualReportModal()">
          <i data-lucide="x"></i>
        </button>
      </div>
      
      <div class="annual-modal-body">
        <div class="annual-modal-info">
          <p>Rapor oluÅŸturmak istediÄŸiniz siteleri seÃ§in. AynÄ± kategoriden birden fazla site seÃ§erek gruplu rapor oluÅŸturabilirsiniz.</p>
        </div>
        
        <div class="annual-year-selector">
          <label>Rapor YÄ±lÄ±:</label>
          <select id="annualReportYear">
            <script>
              // Start from last completed year (current year - 1) for annual reports
              const currentYear = new Date().getFullYear();
              const startYear = currentYear - 1; // 2025 (since 2026 is not complete)
              for (let y = startYear; y >= startYear - 4; y--) {
                document.write(`<option value="${y}">${y}</option>`);
              }
            </script>
          </select>
        </div>
        
        <div class="annual-site-categories" id="annualSiteCategories">
          <!-- Categories will be populated dynamically -->
          <div class="loading-categories">
            <i data-lucide="loader-2" class="spin"></i>
            <span>Siteler yÃ¼kleniyor...</span>
          </div>
        </div>
        
        <div class="annual-selection-summary" id="annualSelectionSummary" style="display: none;">
          <div class="summary-header">
            <i data-lucide="check-circle"></i>
            <span>SeÃ§ilen Siteler</span>
          </div>
          <div class="summary-content" id="selectedSitesList"></div>
        </div>
      </div>
      
      <div class="annual-modal-footer">
        <button class="btn-secondary" onclick="closeAnnualReportModal()">Ä°ptal</button>
        <button class="btn-primary" id="generateAnnualReportBtn" onclick="generateAnnualReport()" disabled>
          <i data-lucide="file-bar-chart"></i>
          Rapor OluÅŸtur
        </button>
      </div>
    </div>
  </div>

  <script>
    // Annual Report Modal Functions
    let annualSitesData = null;
    let selectedAnnualSites = [];

    async function openAnnualReportModal() {
      const modal = document.getElementById('annualReportModal');
      modal.classList.add('open');
      
      // Re-init lucide icons for modal
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
      
      // Load sites if not already loaded
      if (!annualSitesData) {
        await loadAnnualSites();
      }
    }

    function closeAnnualReportModal() {
      document.getElementById('annualReportModal').classList.remove('open');
    }

    async function loadAnnualSites() {
      try {
        const response = await fetch('https://matomo-analytics-backend.isohtel.com.tr/api/sites');
        annualSitesData = await response.json();
        renderAnnualSiteCategories();
      } catch (error) {
        console.error('Failed to load sites:', error);
        document.getElementById('annualSiteCategories').innerHTML = `
          <div class="error-message">
            <i data-lucide="alert-circle"></i>
            <span>Siteler yÃ¼klenemedi. Backend Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olun.</span>
          </div>
        `;
      }
    }

    function renderAnnualSiteCategories() {
      const container = document.getElementById('annualSiteCategories');
      const grouped = annualSitesData.grouped;
      
      let html = '';
      
      Object.entries(grouped).forEach(([key, category]) => {
        if (category.sites && category.sites.length > 0) {
          html += `
            <div class="annual-category" data-category="${key}">
              <div class="annual-category-header" onclick="toggleCategory('${key}')">
                <div class="category-info">
                  <span class="category-icon">${category.icon}</span>
                  <span class="category-name">${category.name}</span>
                  <span class="category-count">(${category.sites.length} site)</span>
                </div>
                <div class="category-actions">
                  <button class="select-all-btn" onclick="event.stopPropagation(); selectAllInCategory('${key}')">
                    TÃ¼mÃ¼nÃ¼ SeÃ§
                  </button>
                  <i data-lucide="chevron-down" class="expand-icon"></i>
                </div>
              </div>
              <div class="annual-category-sites" id="category-${key}">
                ${category.sites.map(site => `
                  <label class="annual-site-item" data-category="${key}">
                    <input type="checkbox" 
                           value="${site.id}" 
                           data-name="${site.name}"
                           data-category="${key}"
                           onchange="handleSiteSelection(this)">
                    <span class="site-name">${site.name}</span>
                  </label>
                `).join('')}
              </div>
            </div>
          `;
        }
      });
      
      container.innerHTML = html;
      
      // Re-init lucide icons
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    }

    function toggleCategory(categoryKey) {
      const categoryEl = document.querySelector(`.annual-category[data-category="${categoryKey}"]`);
      categoryEl.classList.toggle('expanded');
    }

    function selectAllInCategory(categoryKey) {
      const checkboxes = document.querySelectorAll(`input[data-category="${categoryKey}"]`);
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);
      
      checkboxes.forEach(cb => {
        cb.checked = !allChecked;
        handleSiteSelection(cb, false);
      });
      
      updateSelectionSummary();
    }

    function handleSiteSelection(checkbox, updateSummary = true) {
      const siteId = checkbox.value;
      const siteName = checkbox.dataset.name;
      const category = checkbox.dataset.category;
      
      if (checkbox.checked) {
        // Check if selecting from a different category
        if (selectedAnnualSites.length > 0) {
          const existingCategory = selectedAnnualSites[0].category;
          if (existingCategory !== category) {
            // Uncheck all from other categories
            document.querySelectorAll(`input[data-category]:not([data-category="${category}"])`).forEach(cb => {
              cb.checked = false;
            });
            selectedAnnualSites = [];
          }
        }
        
        // Add to selection
        if (!selectedAnnualSites.find(s => s.id === siteId)) {
          selectedAnnualSites.push({ id: siteId, name: siteName, category: category });
        }
      } else {
        // Remove from selection
        selectedAnnualSites = selectedAnnualSites.filter(s => s.id !== siteId);
      }
      
      if (updateSummary) {
        updateSelectionSummary();
      }
    }

    function updateSelectionSummary() {
      const summaryEl = document.getElementById('annualSelectionSummary');
      const listEl = document.getElementById('selectedSitesList');
      const generateBtn = document.getElementById('generateAnnualReportBtn');
      
      if (selectedAnnualSites.length === 0) {
        summaryEl.style.display = 'none';
        generateBtn.disabled = true;
        return;
      }
      
      summaryEl.style.display = 'block';
      generateBtn.disabled = false;
      
      const categoryName = annualSitesData.categories[selectedAnnualSites[0].category]?.name || 'SeÃ§ili';
      const categoryIcon = annualSitesData.categories[selectedAnnualSites[0].category]?.icon || 'ğŸ“';
      
      listEl.innerHTML = `
        <div class="summary-category">
          <span class="summary-icon">${categoryIcon}</span>
          <span class="summary-category-name">${categoryName}</span>
        </div>
        <div class="summary-sites">
          ${selectedAnnualSites.map(s => `<span class="summary-site-tag">${s.name}</span>`).join('')}
        </div>
        ${selectedAnnualSites.length > 1 ? `
          <div class="summary-note">
            <i data-lucide="info"></i>
            <span>${selectedAnnualSites.length} sitenin verileri birleÅŸtirilerek tek rapor oluÅŸturulacak.</span>
          </div>
        ` : ''}
      `;
      
      // Re-init lucide icons
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    }

    function generateAnnualReport() {
      if (selectedAnnualSites.length === 0) return;
      
      const year = document.getElementById('annualReportYear').value;
      
      // Store selection in localStorage
      localStorage.setItem('annualReportSites', JSON.stringify(selectedAnnualSites));
      localStorage.setItem('annualReportYear', year);
      
      // Navigate to annual summary page
      window.location.href = 'annual_summary.html';
    }

    // Close modal on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeAnnualReportModal();
      }
    });

    // Close modal on overlay click
    document.getElementById('annualReportModal')?.addEventListener('click', (e) => {
      if (e.target.classList.contains('annual-modal-overlay')) {
        closeAnnualReportModal();
      }
    });
  </script>
</body>

</html>
